# Master configuration
interface: 0.0.0.0
auto_accept: True  # Automatically accept minion keys (for testing only, not recommended in production)

# Set logging level
log_level: info

# File server settings
file_roots:
  base:
    - /srv/salt

# Enable debugging for troubleshooting
log_level_logfile: debug

# Allow ping commands
allow_minion_peer_ping: True

# Enable file server
fileserver_backend:
  - roots
  - azurefs
  - gitfs

# Azure Files Configuration
azurefs:
  - account_name: env:AZURE_STORAGE_ACCOUNT
    account_key: env:AZURE_STORAGE_KEY
    container_name: env:AZURE_CONTAINER_NAME

pillar_roots:
  base:
    - /srv/pillar

# Add API logging
api_logfile: /var/log/salt/api
api_logfile_level: debug

# Add request/response logging
log_fmt_logfile: '%(asctime)s,%(msecs)03d [%(name)-17s][%(levelname)-8s] %(message)s'

# Add rate limiting
api_rate_limit: 100
api_burst_limit: 30

# Enable netapi clients
netapi_enable_clients:
  - local
  - runner
  - wheel
  - jobs

# ACL configuration
publisher_acl:
  saltapi:
    - test.*
    - state.*
    - grains.*
    - status.*
    - system.*

publisher_acl_blacklist:
  saltapi:
    - cmd.*
    - runners.jobs.kill
    - wheel.config.update_config
    - wheel.key.delete_key

# Enable ACL enforcement
publisher_acl_strict: True